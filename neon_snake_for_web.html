
<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
<title>–ù–µ–æ–Ω–æ–≤–∞—è –ó–º–µ–π–∫–∞</title>
<style>
  :root{
    --bg1: #0f0c29;
    --bg2: #302b63;
    --bg3: #24243e;
    --accent: #00ffc6;
    --accent2: #ff00d4;
    --accent3: #ffe600;
    --danger: #ff2e63;
    --glow: 0 0 12px rgba(0,255,198,.95), 0 0 30px rgba(255,0,212,.5);
    --soft: 0 8px 24px rgba(0,0,0,.35);
  }
  html,body{
    height:100%;
    margin:0;
    background: radial-gradient(100% 140% at 0% 0%, var(--bg2), var(--bg3) 40%), linear-gradient(120deg, var(--bg1), var(--bg3));
    font-family: system-ui, -apple-system, Segoe UI, Roboto, "Inter", Arial, sans-serif;
    color: #e9f4ff;
    overflow: hidden;
    -webkit-tap-highlight-color: transparent;
  }
  .wrap{
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:space-between;
    height:100%;
    gap:8px;
  }
  header{
    width:100%;
    padding:10px 14px 0;
    box-sizing:border-box;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
  }
  .brand{
    display:flex;
    align-items:center;
    gap:10px;
    font-weight:800;
    letter-spacing:.4px;
    text-transform:uppercase;
    font-size:14px;
    opacity:.95;
    text-shadow: var(--glow);
  }
  .badge{
    font-size:10px;
    font-weight:700;
    padding:4px 8px;
    border-radius:999px;
    background: linear-gradient(135deg, rgba(0,255,198,.2), rgba(255,0,212,.2));
    border:1px solid rgba(255,255,255,.15);
    box-shadow: var(--soft);
  }
  .hud{
    display:flex;
    align-items:center;
    gap:10px;
  }
  .pill{
    display:inline-flex; align-items:center; gap:8px;
    padding:8px 12px; border-radius:10px;
    background: rgba(255,255,255,.06);
    border: 1px solid rgba(255,255,255,.12);
    box-shadow: var(--soft);
    font-weight:700; font-size:13px; letter-spacing:.2px;
    white-space:nowrap;
  }
  .pill .v{font-variant-numeric: tabular-nums; min-width: 2ch; text-align:right;}
  .btn{
    appearance:none; border:0; cursor:pointer; outline:none;
    background: linear-gradient(135deg, rgba(0,255,198,.18), rgba(255,0,212,.18));
    border:1px solid rgba(255,255,255,.2);
    padding:10px 14px; border-radius:12px; font-weight:800; color:#071518;
    box-shadow: 0 6px 18px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.25);
    transition: transform .05s ease;
  }
  .btn:active{ transform: translateY(1px) scale(.99); }
  .canvasBox{
    position:relative; width:100%; flex:1; display:flex; align-items:center; justify-content:center;
    padding:8px 14px; box-sizing:border-box;
  }
  #game{
    width:min(95vw, 640px); height:min(95vw, 640px);
    max-height: calc(100vh - 260px);
    background: radial-gradient(100% 100% at 50% 40%, rgba(255,255,255,.06), rgba(255,255,255,.02) 50%, rgba(0,0,0,.12) 100%);
    border-radius:18px; border:1px solid rgba(255,255,255,.18);
    box-shadow: 0 16px 40px rgba(0,0,0,.35), inset 0 0 60px rgba(0,0,0,.2);
    touch-action: none;
  }
  .dpad{
    width: min(92vw, 520px);
    display:grid; grid-template-columns:repeat(3,1fr);
    gap:10px; margin:8px auto 16px;
    user-select:none;
  }
  .dpad .b{
    height:64px; border-radius:14px; display:flex; align-items:center; justify-content:center;
    background: linear-gradient(135deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
    border:1px solid rgba(255,255,255,.18);
    box-shadow: var(--soft);
    font-size:18px; font-weight:900; letter-spacing:.4px;
    text-shadow: var(--glow);
  }
  .b:active{ filter: brightness(1.3); transform: scale(.98); }
  .dpad .empty{ background: transparent; border:0; box-shadow:none; }
  footer{
    font-size:11px; opacity:.75; padding:0 14px 12px; text-align:center;
  }
  .modal{
    position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
    background: radial-gradient(120% 120% at 50% 50%, rgba(5,12,24,.7), rgba(5,12,24,.85));
    border-radius:inherit;
    z-index:10; text-align:center;
    padding:16px;
  }
  .card{
    width:min(90%,520px); background: linear-gradient(160deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
    border:1px solid rgba(255,255,255,.2); border-radius:16px;
    box-shadow: 0 18px 50px rgba(0,0,0,.6), inset 0 0 40px rgba(255,255,255,.05);
    padding:18px; display:flex; flex-direction:column; gap:12px;
  }
  .title{
    font-size:22px; font-weight:900; letter-spacing:.6px;
    text-shadow: var(--glow);
  }
  .row{ display:flex; align-items:center; justify-content:center; gap:12px; flex-wrap:wrap; }
  .chip{
    padding:6px 10px; border-radius:999px;
    border:1px solid rgba(255,255,255,.25);
    background: rgba(255,255,255,.06);
    font-size:12px; font-weight:700; letter-spacing:.2px;
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        üêç –ù–µ–æ–Ω–æ–≤–∞—è –ó–º–µ–π–∫–∞
        <span class="badge">Tap / Swipe / ‚¨ÖÔ∏è‚¨ÜÔ∏è‚û°Ô∏è‚¨áÔ∏è</span>
      </div>
      <div class="hud">
        <div class="pill">–°—á—ë—Ç: <span class="v" id="score">0</span></div>
        <div class="pill">–†–µ–∫–æ—Ä–¥: <span class="v" id="best">0</span></div>
        <button class="btn" id="pauseBtn">–ü–∞—É–∑–∞</button>
      </div>
    </header>

    <div class="canvasBox">
      <canvas id="game" width="600" height="600"></canvas>
      <div class="modal" id="overlay" hidden>
        <div class="card">
          <div class="title" id="title">–ü–æ–≥–Ω–∞–ª–∏?</div>
          <div class="row" id="subtitle">–°–≤–∞–π–ø–∞–π –∏–ª–∏ –∂–º–∏ —Å—Ç—Ä–µ–ª–∫–∏, —á—Ç–æ–±—ã —Ä—É–ª–∏—Ç—å. –°—ä–µ—à—å –∫–∞–∫ –º–æ–∂–Ω–æ –±–æ–ª—å—à–µ!</div>
          <div class="row">
            <button class="btn" id="startBtn">–°—Ç–∞—Ä—Ç</button>
            <button class="btn" id="restartBtn" hidden>–ó–∞–Ω–æ–≤–æ</button>
            <button class="btn" id="resumeBtn" hidden>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
          </div>
          <div class="row">
            <span class="chip">–£—Å–∫–æ—Ä–µ–Ω–∏–µ —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º</span>
            <span class="chip">–í–∏–±—Ä–∞—Ü–∏—è + —á–∞—Å—Ç–∏—Ü—ã</span>
            <span class="chip">–õ–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–∫–æ—Ä–¥</span>
          </div>
        </div>
      </div>
    </div>

    <div class="dpad" id="dpad">
      <div class="b empty"></div>
      <button class="b" data-dir="up">‚ñ≤</button>
      <div class="b empty"></div>
      <button class="b" data-dir="left">‚óÄ</button>
      <div class="b empty"></div>
      <button class="b" data-dir="right">‚ñ∂</button>
      <div class="b empty"></div>
      <button class="b" data-dir="down">‚ñº</button>
      <div class="b empty"></div>
    </div>

    <footer>–°–æ–≤–µ—Ç: —Ç–∞–ø –ø–æ –ø–æ–ª—é ‚Äî –ø–∞—É–∑–∞/–ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å. –ß–µ–º –±–æ–ª—å—à–µ —Å—ä–µ–ª ‚Äî —Ç–µ–º –±—ã—Å—Ç—Ä–µ–µ üåÄ</footer>
  </div>

<script>
(() => {
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const scoreEl = document.getElementById('score');
  const bestEl = document.getElementById('best');
  const pauseBtn = document.getElementById('pauseBtn');
  const overlay = document.getElementById('overlay');
  const startBtn = document.getElementById('startBtn');
  const restartBtn = document.getElementById('restartBtn');
  const resumeBtn = document.getElementById('resumeBtn');
  const titleEl = document.getElementById('title');
  const subtitleEl = document.getElementById('subtitle');

  const GRID = 24;        // —Ä–∞–∑–º–µ—Ä —è—á–µ–π–∫–∏
  const START_LEN = 6;    // —Å—Ç–∞—Ä—Ç–æ–≤–∞—è –¥–ª–∏–Ω–∞
  const SPEED_BASE = 115; // —á–µ–º –º–µ–Ω—å—à–µ ‚Äî —Ç–µ–º –±—ã—Å—Ç—Ä–µ–µ
  const SPEED_STEP = 3;   // —É—Å–∫–æ—Ä–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ N –æ—á–∫–æ–≤
  const SPEED_MIN = 45;

  let cells = Math.floor(canvas.width / GRID);
  let rafId = null;
  let playing = false;
  let paused = false;

  const rnd = (min, max) => Math.floor(Math.random()*(max-min+1))+min;
  const vibrate = (p) => { try{ if(navigator.vibrate) navigator.vibrate(p); }catch(e){} };

  // Audio (–º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –±–∏–ø—ã —á–µ—Ä–µ–∑ WebAudio)
  let audioCtx = null;
  function beep(vol=0.04, freq=520, duration=60, type='square'){
    try{
      if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type = type; o.frequency.value = freq;
      g.gain.value = vol;
      o.connect(g); g.connect(audioCtx.destination);
      o.start();
      setTimeout(() => { o.stop(); }, duration);
    }catch(e){}
  }

  class Snake{
    constructor(){
      this.reset();
    }
    reset(){
      this.dir = {x:1, y:0};
      const cx = Math.floor(cells/2);
      const cy = Math.floor(cells/2);
      this.body = [];
      for(let i=START_LEN-1; i>=0; i--) this.body.push({x:cx-i, y:cy});
      this.grow = 0;
      this.dead = false;
      this.steps = 0;
    }
    setDir(nx, ny){
      // –∑–∞–ø—Ä–µ—â–∞–µ–º —Ä–∞–∑–≤–æ—Ä–æ—Ç –≤ —Å–µ–±—è
      if(this.body.length>1 && nx===-this.dir.x && ny===-this.dir.y) return;
      this.dir = {x:nx, y:ny};
    }
    move(){
      const head = this.body[0];
      const nx = (head.x + this.dir.x + cells) % cells;
      const ny = (head.y + this.dir.y + cells) % cells;
      // –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–∞–º–æ–ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ
      for(const p of this.body){
        if(p.x===nx && p.y===ny){
          this.dead = true;
          return;
        }
      }
      this.body.unshift({x:nx, y:ny});
      if(this.grow>0){ this.grow--; } else { this.body.pop(); }
      this.steps++;
    }
  }

  class Food{
    constructor(){ this.relocate(); this.pulse = 0; }
    relocate(){
      this.x = rnd(0, cells-1);
      this.y = rnd(0, cells-1);
    }
    draw(){
      const x = this.x*GRID, y=this.y*GRID;
      this.pulse = (this.pulse + 1) % 60;
      const k = 0.5 + 0.5*Math.sin(this.pulse/60*Math.PI*2);
      const r = GRID*0.35 + k*2;

      // —Å–≤–µ—á–µ–Ω–∏–µ
      ctx.save();
      ctx.shadowBlur = 16;
      ctx.shadowColor = 'rgba(255, 230, 0, 0.9)';
      // –≥—Ä–∞–¥–∏–µ–Ω—Ç
      const g = ctx.createRadialGradient(x+GRID/2, y+GRID/2, 2, x+GRID/2, y+GRID/2, r);
      g.addColorStop(0, 'rgba(255,230,0,1)');
      g.addColorStop(1, 'rgba(255,0,212,0.2)');
      ctx.fillStyle = g;
      ctx.beginPath();
      ctx.arc(x+GRID/2, y+GRID/2, r, 0, Math.PI*2);
      ctx.fill();
      ctx.restore();
    }
  }

  // —á–∞—Å—Ç–∏—Ü—ã
  const particles = [];
  function burst(x, y, color='#00ffc6'){
    for(let i=0;i<12;i++){
      particles.push({
        x: x*GRID + GRID/2,
        y: y*GRID + GRID/2,
        vx: (Math.random()-0.5)*6,
        vy: (Math.random()-0.5)*6,
        life: rnd(18,28),
        color
      });
    }
  }
  function drawParticles(){
    for(let i=particles.length-1;i>=0;i--){
      const p = particles[i];
      p.x += p.vx; p.y += p.vy; p.vy += 0.08; p.life--;
      ctx.globalAlpha = Math.max(p.life/28,0);
      ctx.fillStyle = p.color;
      ctx.fillRect(p.x-2,p.y-2,4,4);
      ctx.globalAlpha = 1;
      if(p.life<=0) particles.splice(i,1);
    }
  }

  const snake = new Snake();
  const food = new Food();
  let score = 0;
  let best = parseInt(localStorage.getItem('neon-snake-best')||'0');
  bestEl.textContent = best;

  let acc = 0;
  let speed = SPEED_BASE;
  let last = performance.now();

  function logic(dt){
    acc += dt;
    const currentSpeed = Math.max(SPEED_MIN, speed - Math.floor(score/SPEED_STEP)*5);
    while(acc >= currentSpeed){
      snake.move();
      acc -= currentSpeed;

      // –ø—Ä–æ–≤–µ—Ä–∫–∞ –µ–¥—ã
      if(snake.body[0].x===food.x && snake.body[0].y===food.y){
        snake.grow += 2;
        score++; scoreEl.textContent = score;
        beep(0.05, 660, 70, 'sine');
        vibrate(20);
        burst(food.x, food.y, '#ffe600');
        // –Ω–æ–≤–∞—è –µ–¥–∞ –≤ —Å–≤–æ–±–æ–¥–Ω–æ–π –∫–ª–µ—Ç–∫–µ
        let tries = 0;
        do { food.relocate(); tries++; } 
        while(snake.body.some(p => p.x===food.x && p.y===food.y) && tries<200);
      }

      if(snake.dead){
        gameOver();
        return;
      }
    }
  }

  function drawGrid(){
    ctx.save();
    ctx.globalAlpha = .12;
    ctx.lineWidth = 1;
    for(let i=0;i<=cells;i++){
      ctx.beginPath();
      ctx.moveTo(i*GRID+.5,0);
      ctx.lineTo(i*GRID+.5,canvas.height);
      ctx.strokeStyle = 'rgba(255,255,255,.25)';
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(0,i*GRID+.5);
      ctx.lineTo(canvas.width,i*GRID+.5);
      ctx.stroke();
    }
    ctx.restore();
  }

  function drawSnake(){
    // —Ö–≤–æ—Å—Ç
    for(let i=snake.body.length-1; i>=0; i--){
      const {x,y} = snake.body[i];
      const px = x*GRID, py = y*GRID;
      const t = i / snake.body.length;
      const grd = ctx.createLinearGradient(px,py,px+GRID,py+GRID);
      grd.addColorStop(0, 'hsl('+ (160 + t*120) + ' 100% 50%)');
      grd.addColorStop(1, 'hsl('+ (280 - t*120) + ' 100% 60%)');
      ctx.fillStyle = grd;
      ctx.shadowBlur = 14;
      ctx.shadowColor = 'rgba(0,255,198,.6)';
      ctx.fillRect(px+2, py+2, GRID-4, GRID-4);
    }
    // –≥–ª–∞–∑–∞
    const head = snake.body[0];
    ctx.fillStyle = '#071518';
    const hx = head.x*GRID, hy = head.y*GRID;
    ctx.beginPath();
    ctx.arc(hx+GRID*0.65, hy+GRID*0.35, 3, 0, Math.PI*2); ctx.fill();
    ctx.beginPath();
    ctx.arc(hx+GRID*0.35, hy+GRID*0.65, 3, 0, Math.PI*2); ctx.fill();
  }

  function render(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    drawGrid();
    drawSnake();
    food.draw();
    drawParticles();
  }

  function loop(ts){
    const dt = ts - last; last = ts;
    if(playing && !paused){
      logic(dt);
      render();
    }
    rafId = requestAnimationFrame(loop);
  }

  function start(){
    playing = true; paused = false;
    overlay.hidden = true;
    last = performance.now(); acc = 0; speed = SPEED_BASE; score = 0;
    snake.reset(); food.relocate();
    scoreEl.textContent = '0';
    pauseBtn.textContent = '–ü–∞—É–∑–∞';
    if(!rafId) rafId = requestAnimationFrame(loop);
  }
  function pause(toggle=true){
    if(!playing) return;
    paused = toggle ? !paused : true;
    overlay.hidden = !paused;
    titleEl.textContent = paused ? '–ü–∞—É–∑–∞' : '–ü–æ–≥–Ω–∞–ª–∏?';
    subtitleEl.textContent = paused ? '–ñ–º–∏ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å, —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∏–≥—Ä—É.' : '–°–≤–∞–π–ø–∞–π –∏–ª–∏ –∂–º–∏ —Å—Ç—Ä–µ–ª–∫–∏, —á—Ç–æ–±—ã —Ä—É–ª–∏—Ç—å.';
    startBtn.hidden = true;
    restartBtn.hidden = true;
    resumeBtn.hidden = !paused ? true : false;
    pauseBtn.textContent = paused ? '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å' : '–ü–∞—É–∑–∞';
  }
  function gameOver(){
    playing = false; paused = false;
    overlay.hidden = false;
    titleEl.textContent = '–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞ üí•';
    subtitleEl.textContent = `–°—á—ë—Ç: ${score}`;
    startBtn.hidden = true;
    resumeBtn.hidden = true;
    restartBtn.hidden = false;
    beep(0.08, 120, 200, 'sawtooth'); vibrate([30,30,30]);
    if(score>best){ best=score; localStorage.setItem('neon-snake-best', best); bestEl.textContent = best; burst(snake.body[0].x, snake.body[0].y, '#ff00d4'); }
  }

  // —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
  const keys = {ArrowUp:[0,-1], ArrowDown:[0,1], ArrowLeft:[-1,0], ArrowRight:[1,0], w:[0,-1], s:[0,1], a:[-1,0], d:[1,0]};
  window.addEventListener('keydown', (e)=>{
    if(keys[e.key]){ e.preventDefault(); const [x,y]=keys[e.key]; snake.setDir(x,y); }
    if(e.key===' '){ e.preventDefault(); pause(); }
    if(e.key==='Enter' && overlay.hidden) { /* no-op */ }
  }, {passive:false});

  // dpad
  document.getElementById('dpad').addEventListener('click', (e)=>{
    const b = e.target.closest('[data-dir]'); if(!b) return;
    const d = b.getAttribute('data-dir');
    const map = {up:[0,-1],down:[0,1],left:[-1,0],right:[1,0]};
    const v = map[d]; snake.setDir(v[0], v[1]);
  });

  // —Å–≤–∞–π–ø—ã
  let sx=0, sy=0, sm=0;
  const touchStart = (x,y)=>{ sx=x; sy=y; sm=0; };
  const touchMove = (x,y)=>{ sm++; };
  const touchEnd = (x,y)=>{
    const dx = x-sx, dy = y-sy;
    if(Math.abs(dx) < 8 && Math.abs(dy) < 8 && sm<3){
      // tap -> –ø–∞—É–∑–∞/–ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å
      if(playing && overlay.hidden){ pause(); return; }
    }
    if(Math.abs(dx) > Math.abs(dy)){
      snake.setDir(dx>0?1:-1, 0);
    }else{
      snake.setDir(0, dy>0?1:-1);
    }
  };
  const addTouch = (el)=>{
    el.addEventListener('touchstart', (e)=>{ const t=e.changedTouches[0]; touchStart(t.clientX, t.clientY); }, {passive:true});
    el.addEventListener('touchmove', (e)=>{ const t=e.changedTouches[0]; touchMove(t.clientX, t.clientY); }, {passive:true});
    el.addEventListener('touchend', (e)=>{ const t=e.changedTouches[0]; touchEnd(t.clientX, t.clientY); }, {passive:true});
  };
  addTouch(canvas); addTouch(document.getElementById('dpad'));

  // –∫–Ω–æ–ø–∫–∏
  startBtn.addEventListener('click', start);
  restartBtn.addEventListener('click', start);
  resumeBtn.addEventListener('click', ()=> pause(false));
  pauseBtn.addEventListener('click', ()=>{
    if(!playing){ start(); return; }
    pause();
  });

  // –ø–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω
  overlay.hidden = false;

  // –º–∞—Å—à—Ç–∞–± —Å–µ—Ç–∫–∏ –ø–æ–¥ —Ä–∞–∑–º–µ—Ä –∫–∞–Ω–≤–∞—Å–∞, –µ—Å–ª–∏ –º–µ–Ω—è–µ—Ç—Å—è (—Ä–µ–¥–∫–æ –≤ –Ω–æ—É—Ç–±—É–∫–µ, –Ω–æ –ø—É—Å—Ç—å –±—É–¥–µ—Ç)
  function reflow(){
    const size = Math.min(window.innerWidth*0.95, 640, window.innerHeight-260);
    const s = Math.max(360, Math.floor(size/GRID)*GRID);
    canvas.style.width = s+'px'; canvas.style.height = s+'px';
  }
  window.addEventListener('resize', reflow); reflow();

  // —Å—Ç–∞—Ä—Ç —Ä–µ–Ω–¥–µ—Ä–∞
  rafId = requestAnimationFrame(loop);
})();
</script>
</body>
</html>
